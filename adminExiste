# ğŸ“Œ README â€“ Gestion automatique de lâ€™admin par procÃ©dure SQL

## âš™ï¸ Objectif
Ce systÃ¨me permet de sâ€™assurer quâ€™un **compte administrateur par dÃ©faut** existe toujours dans la base de donnÃ©es.  
- Si lâ€™admin nâ€™existe pas â†’ il est crÃ©Ã© automatiquement.  
- Si lâ€™admin existe mais que son mot de passe est incorrect â†’ il est mis Ã  jour avec le bon hash.  

---

## ğŸ› ï¸ 1. CrÃ©ation de la procÃ©dure

ExÃ©cute ce script SQL dans **phpMyAdmin** ou ton client MySQL habituel :

```sql
DELIMITER $$

CREATE PROCEDURE EnsureAdminExists()
BEGIN
    DECLARE v_id INT;
    DECLARE v_password VARCHAR(255);

    -- VÃ©rifier si l'admin existe dÃ©jÃ  par tÃ©lÃ©phone
    SELECT id, password INTO v_id, v_password
    FROM admin
    WHERE telephone = '0777515789'
    LIMIT 1;

    -- Si trouvÃ©, corriger le mot de passe si besoin
    IF v_id IS NOT NULL THEN
        IF v_password <> '$2y$10$pgZ/x68OO2Hx4JB1X2h5PO7AokbuPLXDxvnKLe3YZxPfbUH53w3di' THEN
            UPDATE admin
            SET password = '$2y$10$pgZ/x68OO2Hx4JB1X2h5PO7AokbuPLXDxvnKLe3YZxPfbUH53w3di'
            WHERE id = v_id;
        END IF;
    ELSE
        -- Sinon, crÃ©er l'admin avec toutes les infos
        INSERT INTO admin (telephone, password, name, firstname, email)
        VALUES (
            '0777515789',
            '$2y$10$pgZ/x68OO2Hx4JB1X2h5PO7AokbuPLXDxvnKLe3YZxPfbUH53w3di',
            'Developpeur',
            'Fullstack',
            'a.kouamemartial7@gmail.com'
        );
    END IF;
END$$

DELIMITER ;
ğŸ› ï¸ 2. Commandes utiles
Appeler la procÃ©dure manuellement :

sql
Copier
Modifier
CALL EnsureAdminExists();
Supprimer la procÃ©dure :

sql
Copier
Modifier
DROP PROCEDURE IF EXISTS EnsureAdminExists;
Lister les procÃ©dures existantes :

sql
Copier
Modifier
SHOW PROCEDURE STATUS WHERE Db = 'nom_de_ta_base';
ğŸ› ï¸ 3. IntÃ©gration dans PHP
Dans ta classe Database, tu peux appeler la procÃ©dure automatiquement aprÃ¨s connexion :

php
Copier
Modifier
try {
    $this->pdo = new PDO($this->dns, $this->user, $this->password, [
        PDO::ATTR_PERSISTENT => true,
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::MYSQL_ATTR_INIT_COMMAND => 'SET NAMES utf8mb4'
    ]);

    // VÃ©rifie et corrige/crÃ©e l'admin
    $this->pdo->query("CALL EnsureAdminExists()");
    
} catch (Exception $e) {
    die("Erreur de connexion Ã  la base de donnÃ©es : " . $e->getMessage());
}
ğŸ”’ 4. Infos importantes
Le mot de passe stockÃ© est un hash bcrypt :

perl
Copier
Modifier
$2y$10$pgZ/x68OO2Hx4JB1X2h5PO7AokbuPLXDxvnKLe3YZxPfbUH53w3di
ğŸ‘‰ tu peux le rÃ©gÃ©nÃ©rer avec password_hash("ton_mot_de_passe", PASSWORD_BCRYPT).

Cette procÃ©dure peut Ãªtre appelÃ©e Ã  chaque connexion PHP pour garantir la prÃ©sence de lâ€™admin.

Si tu changes le tÃ©lÃ©phone ou lâ€™email, pense Ã  modifier la procÃ©dure.
